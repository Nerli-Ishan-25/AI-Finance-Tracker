import React from 'react';
import { AlertTriangle, CheckCircle, XCircle, Loader } from 'lucide-react';

interface RiskAssessmentProps {
  applicationData: any;
  riskScore: number | null;
  isAnalyzing: boolean;
}

export function RiskAssessment({ applicationData, riskScore, isAnalyzing }: RiskAssessmentProps) {
  const getRiskLevel = (score: number) => {
    if (score < 0.3) return 'low';
    if (score < 0.7) return 'medium';
    return 'high';
  };

  const getRiskColor = (level: string) => {
    switch (level) {
      case 'low': return 'text-green-600 bg-green-100';
      case 'medium': return 'text-yellow-600 bg-yellow-100';
      case 'high': return 'text-red-600 bg-red-100';
      default: return 'text-gray-600 bg-gray-100';
    }
  };

  const getRiskIcon = (level: string) => {
    switch (level) {
      case 'low': return <CheckCircle className="h-6 w-6 text-green-600" />;
      case 'medium': return <AlertTriangle className="h-6 w-6 text-yellow-600" />;
      case 'high': return <XCircle className="h-6 w-6 text-red-600" />;
      default: return null;
    }
  };

  const getRecommendation = (level: string, score: number) => {
    switch (level) {
      case 'low':
        return {
          decision: 'APPROVE',
          message: 'Low default risk. Recommend approval with standard terms.',
          color: 'text-green-700 bg-green-50 border-green-200'
        };
      case 'medium':
        return {
          decision: 'REVIEW',
          message: 'Moderate default risk. Manual review recommended.',
          color: 'text-yellow-700 bg-yellow-50 border-yellow-200'
        };
      case 'high':
        return {
          decision: 'REJECT',
          message: 'High default risk. Recommend rejection or alternative terms.',
          color: 'text-red-700 bg-red-50 border-red-200'
        };
      default:
        return {
          decision: 'PENDING',
          message: 'Analysis in progress...',
          color: 'text-gray-700 bg-gray-50 border-gray-200'
        };
    }
  };

  if (isAnalyzing) {
    return (
      <div className="bg-white rounded-lg shadow-sm border">
        <div className="p-6">
          <div className="flex items-center justify-center space-x-3 py-12">
            <Loader className="h-8 w-8 text-blue-600 animate-spin" />
            <div className="text-lg font-medium text-gray-900">Analyzing Risk...</div>
          </div>
          <div className="text-center text-gray-600">
            <p>Running ML models and compliance checks</p>
            <div className="mt-4 w-full bg-gray-200 rounded-full h-2">
              <div className="bg-blue-600 h-2 rounded-full animate-pulse" style={{ width: '70%' }}></div>
            </div>
          </div>
        </div>
      </div>
    );
  }

  if (!riskScore) return null;

  const riskLevel = getRiskLevel(riskScore);
  const recommendation = getRecommendation(riskLevel, riskScore);

  return (
    <div className="bg-white rounded-lg shadow-sm border">
      <div className="p-6">
        <h2 className="text-xl font-semibold text-gray-900 mb-6">Risk Assessment Results</h2>
        
        {/* Risk Score */}
        <div className="text-center mb-6">
          <div className="inline-flex items-center space-x-3 mb-4">
            {getRiskIcon(riskLevel)}
            <div>
              <div className="text-3xl font-bold text-gray-900">
                {(riskScore * 100).toFixed(1)}%
              </div>
              <div className={`px-3 py-1 text-sm font-medium rounded-full ${getRiskColor(riskLevel)}`}>
                {riskLevel.toUpperCase()} RISK
              </div>
            </div>
          </div>
        </div>

        {/* Recommendation */}
        <div className={`p-4 rounded-lg border ${recommendation.color} mb-6`}>
          <div className="flex items-center justify-between mb-2">
            <h3 className="font-semibold">RECOMMENDATION</h3>
            <span className="px-3 py-1 text-sm font-bold rounded-full bg-white bg-opacity-50">
              {recommendation.decision}
            </span>
          </div>
          <p className="text-sm">{recommendation.message}</p>
        </div>

        {/* Application Summary */}
        <div className="border-t pt-6">
          <h3 className="font-medium text-gray-900 mb-4">Application Summary</h3>
          <div className="grid grid-cols-2 gap-4 text-sm">
            <div>
              <span className="text-gray-500">Applicant:</span>
              <div className="font-medium">{applicationData.name}</div>
            </div>
            <div>
              <span className="text-gray-500">Loan Amount:</span>
              <div className="font-medium">${parseInt(applicationData.loanAmount).toLocaleString()}</div>
            </div>
            <div>
              <span className="text-gray-500">Credit Score:</span>
              <div className="font-medium">{applicationData.creditScore}</div>
            </div>
            <div>
              <span className="text-gray-500">Income:</span>
              <div className="font-medium">${parseInt(applicationData.income).toLocaleString()}</div>
            </div>
            <div>
              <span className="text-gray-500">Debt-to-Income:</span>
              <div className="font-medium">{applicationData.debtToIncome}%</div>
            </div>
            <div>
              <span className="text-gray-500">Purpose:</span>
              <div className="font-medium capitalize">{applicationData.loanPurpose}</div>
            </div>
          </div>
        </div>

        {/* Processing Time */}
        <div className="border-t pt-4 mt-6">
          <div className="flex justify-between text-sm text-gray-500">
            <span>Processing completed in 1.2 seconds</span>
            <span>Model: Gradient Boosting v2.1</span>
          </div>
        </div>
      </div>
    </div>
  );
}